Options +ExecCGI

# Allow execution of .cgi scripts.
AddHandler cgi-script .cgi

# Protect files and directories from prying eyes.
<FilesMatch "\.(lua|engine|inc|info|install|module|profile|test|po|sh|.*sql|theme|tpl(\.html)?|xtmpl|svn-base)$|^(code-style\.pl|Entries.*|Repository|Root|Tag|Template|all-wcprops|entries|format)$">
  Order allow,deny
</FilesMatch>

# Handle any 404 errors.
ErrorDocument 404 /lua.cgi

# Set the default handler.
DirectoryIndex lua.cgi

# Force simple error message for requests for non-existent favicon.ico.
<Files favicon.ico>
  # There is no end quote below, for compatibility with Apache 1.3.
  ErrorDocument 404 "The requested file favicon.ico was not found.
</Files>

# Various rewrite rules.
<IfModule mod_rewrite.c>
  RewriteEngine on

  # Rewrite URLs of the form 'x' to the form 'lua.cgi?q=x'.
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_URI} !=/favicon.ico
  RewriteRule ^(.*)$ lua.cgi?q=$1 [L,QSA]
</IfModule>
