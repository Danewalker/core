Ophal installation instructions
===============================

This document is just a brief. For a comprenhensive installation guide please
refer to the online Ophal manual: http://ophal.org/manual.

1. Server configuration
This instructions assume that you installed Ophal at /var/www/ophal.

Ophal can run on native Nginx's HttpLuaModule or as a humble CGI script on
Apache, Lighttpd and others that support CGI and URL rewriting. FastCGI support
can be implemented with a FastCGI wrapper on Apache, Nginx, Lighttpd and several
other web servers.

== Apache
Enable mod_rewrite and mod_cgi, then use following configuration for reference:

=== Sub-directory
  Alias /lua /var/www/ophal/
        <Directory "/var/www/ophal">
                AllowOverride All
                Options Indexes FollowSymLinks MultiViews +ExecCGI
                Order allow,deny
                Allow from all
        </Directory>

=== Virtualhost
<VirtualHost *:80>
        ServerAlias ophal

        DocumentRoot /var/www/ophal
        <Directory />
                Options FollowSymLinks
                AllowOverride None
        </Directory>
        <Directory /var/www/ophal/>
                Options Indexes FollowSymLinks MultiViews +ExecCGI
                AllowOverride All
                Order allow,deny
                allow from all
        </Directory>

        ErrorLog /var/log/apache2/ophal-error.log

        # Possible values include: debug, info, notice, warn, error, crit,
        # alert, emerg.
        LogLevel debug

        CustomLog /var/log/apache2/ophal-access.log combined

</VirtualHost>

== Lighttpd
Install mod_magnet and use the file lighttpd.ophal.lua to configure your
server. Also, enable module cgi. Then use following configuration for reference:

$HTTP["host"] =~ ".+\.ophal" {
  evhost.path-pattern = "/var/www/%_/"
  index-file.names = ("index.cgi")
  cgi.assign = ( ".cgi" => "/usr/local/bin/luajit" )
  magnet.attract-physical-path-to = ("/etc/lighttpd/lighttpd.ophal.lua")
}

Notice that configuration above assumes that you are using "luajit".

== Nginx
Install HttpLuaModule and use the file nginx.ophal.conf to configure your server.
Make sure to set 'server_name' and 'root' correctly.


2. Dependencies
== LuaJIT or Lua?
Ophal uses Lua 5.1 by default, but is compatible with LuaJIT 2.x if you prefer it.
You need to edit the first line of index.cgi in order to switch interpreter.

== Debian
$ sudo luarocks install lpeg
$ sudo apt-get install uuid-dev
$ sudo luarocks install luuid
$ sudo luarocks install luafilesystem
$ sudo luarocks install luasocket
$ cd /tmp
$ git clone --depth=1 git://github.com/ophal/cgic.git
$ cd cgic && make && sudo make install
$ cd /tmp
$ git clone --depth=1 git://github.com/ophal/seawolf.git
$ sudo mv seawolf /usr/local/share/lua/5.1/

3. Installation wizard
Open your Ophal installation in a web browser, you should be redirected to the Installation
Wizard, follow the instructions. The wizard will check dependencies and ask for configuration
parameters, then will generate a settings.lua for you, copy the text, store as settings.lua
into the same directory of index.cgi, make the desired changes an set it to read-only.

4. Send feedback
Whether you successfully installed Ophal or not, please file an issue with your
feedback at https://github.com/ophal/core/issues/new in order to help us improve
the installation instructions and the installer.


-- The Ophal Team

